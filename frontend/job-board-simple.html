<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Board - LocumTrueRate</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <style>
        .jobs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .job-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .job-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .job-details {
            color: var(--text-secondary);
            margin: 0.5rem 0;
        }
        
        .job-salary {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success);
            margin: 1rem 0;
        }
        
        .filters-section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: 2fr repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        #resultsCount {
            font-weight: 600;
            color: var(--primary);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-close {
            float: right;
            font-size: 2rem;
            cursor: pointer;
            border: none;
            background: none;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">LocumTrueRate</a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="job-board.html" class="nav-link active">Job Board</a></li>
                <li><a href="locum-dashboard.html" class="nav-link">Locum Dashboard</a></li>
                <li><a href="recruiter-dashboard.html" class="nav-link">Recruiter Portal</a></li>
                <li><a href="admin-dashboard.html" class="nav-link">Admin</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <h1>Find Your Perfect Locum Position</h1>
            
            <!-- Filters -->
            <div class="filters-section">
                <div class="filters-grid">
                    <input type="text" id="searchInput" placeholder="Search by title or location..." class="form-control">
                    
                    <select id="specialtyFilter" class="form-control">
                        <option value="">All Specialties</option>
                        <option value="emergency">Emergency Medicine</option>
                        <option value="internal">Internal Medicine</option>
                        <option value="family">Family Medicine</option>
                        <option value="pediatrics">Pediatrics</option>
                        <option value="surgery">Surgery</option>
                    </select>
                    
                    <select id="locationFilter" class="form-control">
                        <option value="">All Locations</option>
                        <option value="CA">California</option>
                        <option value="TX">Texas</option>
                        <option value="FL">Florida</option>
                        <option value="NY">New York</option>
                        <option value="CO">Colorado</option>
                    </select>
                    
                    <select id="sortFilter" class="form-control">
                        <option value="">Sort By</option>
                        <option value="salary-high">Salary: High to Low</option>
                        <option value="salary-low">Salary: Low to High</option>
                        <option value="date">Most Recent</option>
                    </select>
                </div>
                
                <div class="results-info">
                    <span id="resultsCount">0</span> positions found
                </div>
            </div>
            
            <!-- Jobs Grid -->
            <div class="jobs-grid" id="jobsGrid">
                <!-- Jobs will be dynamically loaded here -->
            </div>
        </div>
    </main>
    
    <!-- Job Detail Modal -->
    <div class="modal" id="jobModal">
        <div class="modal-content">
            <button class="modal-close" onclick="jobBoard.closeModal()">&times;</button>
            <div id="modalContent">
                <!-- Job details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 LocumTrueRate. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Simple, clean job board implementation
        const jobBoard = {
            jobs: [],
            filteredJobs: [],
            
            async init() {
                this.jobs = await this.loadJobs();
                this.filteredJobs = [...this.jobs];
                this.render();
                this.attachListeners();
            },
            
            async loadJobs() {
                try {
                    const apiUrl = window.location.hostname === 'localhost' 
                        ? 'http://localhost:4000/api/v1/jobs'
                        : window.location.origin + '/api/v1/jobs';
                    
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    
                    if (data.success && data.jobs) {
                        return data.jobs.map(job => this.transformJob(job));
                    }
                } catch (error) {
                    // Silent fallback to default jobs
                }
                
                return this.getDefaultJobs();
            },
            
            transformJob(apiJob) {
                return {
                    id: apiJob.id,
                    title: apiJob.title,
                    facility: apiJob.hospital_name,
                    location: `${apiJob.city}, ${apiJob.state}`,
                    state: apiJob.state,
                    specialty: apiJob.specialty?.toLowerCase(),
                    salary: `$${apiJob.hourly_rate}/hr`,
                    hourlyRate: apiJob.hourly_rate,
                    duration: `${apiJob.contract_length} weeks`,
                    hours: `${apiJob.weekly_hours} hrs/week`,
                    housing: apiJob.housing_provided ? 'Housing included' : 'No housing',
                    description: apiJob.description || 'Great opportunity for locum physician.',
                    requirements: apiJob.requirements || ['Active medical license', 'Board certification']
                };
            },
            
            getDefaultJobs() {
                return [
                    {
                        id: 1,
                        title: 'Emergency Medicine Physician',
                        facility: 'Metropolitan General Hospital',
                        location: 'Los Angeles, CA',
                        state: 'CA',
                        specialty: 'emergency',
                        salary: '$350/hr',
                        hourlyRate: 350,
                        duration: '13 weeks',
                        hours: '48 hrs/week',
                        housing: 'Housing included',
                        description: 'Join our busy Level 1 trauma center.',
                        requirements: ['Board Certified EM', 'ACLS/PALS Required']
                    },
                    {
                        id: 2,
                        title: 'Internal Medicine Hospitalist',
                        facility: 'Houston Medical Center',
                        location: 'Houston, TX',
                        state: 'TX',
                        specialty: 'internal',
                        salary: '$300/hr',
                        hourlyRate: 300,
                        duration: '26 weeks',
                        hours: '50 hrs/week',
                        housing: 'Housing included',
                        description: 'Seeking experienced hospitalist for busy medical center.',
                        requirements: ['Board Certified IM', '3+ Years Experience']
                    },
                    {
                        id: 3,
                        title: 'Family Medicine Provider',
                        facility: 'Rocky Mountain Clinic',
                        location: 'Denver, CO',
                        state: 'CO',
                        specialty: 'family',
                        salary: '$275/hr',
                        hourlyRate: 275,
                        duration: '13 weeks',
                        hours: '40 hrs/week',
                        housing: 'No housing',
                        description: 'Beautiful clinic in Denver metro area.',
                        requirements: ['Board Certified FM', 'DEA License']
                    }
                ];
            },
            
            render() {
                const grid = document.getElementById('jobsGrid');
                const count = document.getElementById('resultsCount');
                
                count.textContent = this.filteredJobs.length;
                
                if (this.filteredJobs.length === 0) {
                    grid.innerHTML = '<p>No jobs found. Try adjusting your filters.</p>';
                    return;
                }
                
                grid.innerHTML = this.filteredJobs.map(job => `
                    <div class="job-card" onclick="jobBoard.showJob(${job.id})">
                        <h3 class="job-title">${job.title}</h3>
                        <p class="job-details">${job.facility}</p>
                        <p class="job-details">📍 ${job.location}</p>
                        <p class="job-salary">${job.salary}</p>
                        <p class="job-details">${job.duration} • ${job.hours}</p>
                        <p class="job-details">${job.housing}</p>
                    </div>
                `).join('');
            },
            
            filter() {
                const search = document.getElementById('searchInput').value.toLowerCase();
                const specialty = document.getElementById('specialtyFilter').value;
                const location = document.getElementById('locationFilter').value;
                
                this.filteredJobs = this.jobs.filter(job => {
                    const matchesSearch = !search || 
                        job.title.toLowerCase().includes(search) ||
                        job.location.toLowerCase().includes(search);
                    
                    const matchesSpecialty = !specialty || job.specialty === specialty;
                    const matchesLocation = !location || job.state === location;
                    
                    return matchesSearch && matchesSpecialty && matchesLocation;
                });
                
                this.sort();
                this.render();
            },
            
            sort() {
                const sortBy = document.getElementById('sortFilter').value;
                
                if (sortBy === 'salary-high') {
                    this.filteredJobs.sort((a, b) => b.hourlyRate - a.hourlyRate);
                } else if (sortBy === 'salary-low') {
                    this.filteredJobs.sort((a, b) => a.hourlyRate - b.hourlyRate);
                } else if (sortBy === 'date') {
                    this.filteredJobs.sort((a, b) => b.id - a.id);
                }
            },
            
            showJob(id) {
                const job = this.jobs.find(j => j.id === id);
                if (!job) return;
                
                const modal = document.getElementById('jobModal');
                const content = document.getElementById('modalContent');
                
                content.innerHTML = `
                    <h2>${job.title}</h2>
                    <h3>${job.facility}</h3>
                    <p><strong>Location:</strong> ${job.location}</p>
                    <p><strong>Salary:</strong> ${job.salary}</p>
                    <p><strong>Duration:</strong> ${job.duration}</p>
                    <p><strong>Hours:</strong> ${job.hours}</p>
                    <p><strong>Housing:</strong> ${job.housing}</p>
                    <h4>Description</h4>
                    <p>${job.description}</p>
                    <h4>Requirements</h4>
                    <ul>
                        ${job.requirements.map(req => `<li>${req}</li>`).join('')}
                    </ul>
                    <button class="btn btn-primary" onclick="alert('Application feature coming soon!')">Apply Now</button>
                `;
                
                modal.classList.add('active');
            },
            
            closeModal() {
                document.getElementById('jobModal').classList.remove('active');
            },
            
            attachListeners() {
                document.getElementById('searchInput').addEventListener('input', () => this.filter());
                document.getElementById('specialtyFilter').addEventListener('change', () => this.filter());
                document.getElementById('locationFilter').addEventListener('change', () => this.filter());
                document.getElementById('sortFilter').addEventListener('change', () => this.filter());
                
                // Close modal on background click
                document.getElementById('jobModal').addEventListener('click', (e) => {
                    if (e.target.id === 'jobModal') {
                        this.closeModal();
                    }
                });
            }
        };
        
        // Single initialization
        document.addEventListener('DOMContentLoaded', () => jobBoard.init());
    </script>
</body>
</html>