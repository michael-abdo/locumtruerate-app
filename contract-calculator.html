<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Calculator - LocumTrueRate</title>
    <style>
        /* CSS Variables from Design System */
        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --secondary-color: #64748b;
            --accent-color: #10b981;
            --background-color: #f8fafc;
            --surface-color: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --border-light: #f1f5f9;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--background-color);
        }

        /* Navigation */
        .navbar {
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand h2 {
            color: var(--primary-color);
            font-weight: 700;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary-color);
            font-weight: 600;
            border-bottom: 2px solid var(--primary-color);
        }

        .nav-dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-5px);
            transition: all 0.2s ease-in-out;
            z-index: 1000;
            margin-top: 0;
            pointer-events: none;
        }

        .nav-dropdown:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            pointer-events: auto;
        }

        .nav-dropdown::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 10px;
            background: transparent;
            z-index: 999;
        }

        .dropdown-menu li {
            list-style: none;
        }

        .dropdown-menu a {
            display: block;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .dropdown-menu a:hover {
            background-color: var(--background-color);
            color: var(--primary-color);
        }

        /* Layout */
        .page-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex: 1;
            padding: 2rem 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Page Header */
        .page-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .page-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Pre-filled Alert */
        .prefilled-alert {
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 2rem 0;
            text-align: center;
            display: none;
        }

        .prefilled-alert.show {
            display: block;
        }

        /* Calculator Section */
        .calculator-section {
            padding: 3rem 0;
        }

        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: start;
        }

        .calculator-form {
            background-color: var(--surface-color);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .calculator-results {
            background-color: var(--surface-color);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 6rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-select {
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23666" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 0.65rem;
            padding-right: 2.5rem;
            cursor: pointer;
        }
        
        .form-select:hover {
            background-color: var(--gray-50);
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-help {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .form-error {
            font-size: 0.85rem;
            color: var(--error-color);
            margin-top: 0.25rem;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .form-input.error {
            border-color: var(--error-color);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        /* Tooltip System */
        .tooltip-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--text-primary);
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            line-height: 1.4;
            white-space: normal;
            width: 400px;
            min-width: 400px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;
            transform: translateX(-50%) translateY(-5px);
            z-index: 1000;
            margin-bottom: 8px;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--text-primary);
        }

        .tooltip-wrapper:hover .tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .form-group:hover .tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        /* Responsive tooltip positioning */
        @media (max-width: 768px) {
            .tooltip {
                position: fixed;
                bottom: auto;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 320px;
                min-width: 320px;
                margin-bottom: 0;
            }
            
            .tooltip::after {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .tooltip {
                width: 280px;
                min-width: 280px;
            }
        }

        .btn-primary:disabled, .btn-secondary:disabled, .btn-accent:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary:disabled:hover, .btn-secondary:disabled:hover, .btn-accent:disabled:hover {
            transform: none;
            background-color: var(--primary-color);
        }

        /* Results */
        .results-summary {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-summary h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .results-summary .amount {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .results-summary .rate {
            font-size: 1.1rem;
            margin-top: 0.5rem;
            opacity: 0.9;
        }

        .results-breakdown {
            display: grid;
            gap: 1rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: var(--background-color);
            border-radius: 0.5rem;
            border-left: 4px solid var(--border-color);
        }

        .result-item.highlight {
            border-left-color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.05);
        }

        .result-item.warning {
            border-left-color: var(--warning-color);
            background-color: rgba(245, 158, 11, 0.05);
        }

        .result-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .result-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .result-subtext {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* Comparison Section */
        .comparison-section {
            background-color: var(--surface-color);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .comparison-card {
            text-align: center;
            padding: 1.5rem;
            background-color: var(--background-color);
            border-radius: 0.75rem;
            border: 2px solid var(--border-color);
            transition: all 0.2s;
        }

        .comparison-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .comparison-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .comparison-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-accent {
            background-color: var(--accent-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-accent:hover {
            background-color: #059669;
            transform: translateY(-1px);
        }

        /* Footer */
        .footer {
            background-color: var(--text-primary);
            color: var(--text-muted);
            padding: 3rem 0 1rem;
            margin-top: auto;
        }

        .footer-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h4, .footer-section h5 {
            color: white;
            margin-bottom: 1rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section a {
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            border-top: 1px solid var(--secondary-color);
            padding-top: 1rem;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 800px) {
            .container {
                padding: 0 1rem;
            }
            
            .page-header {
                padding: 2rem 0;
            }
            
            .page-header h1 {
                font-size: 2rem;
            }
            
            .calculator-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .calculator-results {
                position: static;
                top: auto;
            }

            .input-group {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-menu {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .floating-logger {
                bottom: 10px;
                right: 10px;
                left: 10px;
                width: auto;
                max-height: 200px;
            }
            
            .results-summary .amount {
                font-size: 2rem;
            }
            
            .calculator-form,
            .calculator-results {
                padding: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 0.5rem;
            }
            
            .calculator-form, .calculator-results {
                padding: 1rem;
            }
            
            .results-summary .amount {
                font-size: 1.8rem;
            }
            
            .comparison-section {
                padding: 1rem;
            }
            
            .form-input {
                font-size: 16px; /* Prevent zoom on iOS */
            }
            
            .btn-primary, .btn-secondary, .btn-accent {
                padding: 0.875rem 1rem;
                font-size: 0.9rem;
            }
            
            .action-buttons {
                gap: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <h2>LocumTrueRate</h2>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="job-board.html" class="nav-link">Job Board</a></li>
                    <li><a href="paycheck-calculator.html" class="nav-link">Paycheck Calculator</a></li>
                    <li><a href="contract-calculator.html" class="nav-link active">Contract Calculator</a></li>
                    <li class="nav-dropdown">
                        <a href="#" class="nav-link">Dashboards</a>
                        <ul class="dropdown-menu">
                            <li><a href="recruiter-dashboard.html">Recruiter</a></li>
                            <li><a href="locum-dashboard.html">Locum</a></li>
                            <li><a href="admin-dashboard.html">Admin</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Page Header -->
        <section class="page-header">
            <div class="container">
                <h1>Contract Calculator</h1>
                <p>Calculate true hourly rates and total contract value with detailed compensation breakdown</p>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main-content">
            <section class="calculator-section">
                <div class="container">
                    <!-- Pre-filled Alert -->
                    <div class="prefilled-alert" id="prefilledAlert">
                        <h3>📋 Job Data Pre-filled</h3>
                        <p>Contract details have been automatically filled from your selected job posting. Feel free to adjust any values.</p>
                    </div>

                    <div class="calculator-container">
                        <!-- Calculator Form -->
                        <div class="calculator-form">
                            <h2 class="section-title">Contract Details</h2>
                            
                            <!-- Basic Contract Info -->
                            <div class="form-group">
                                <label class="form-label">Job Title</label>
                                <div class="tooltip-wrapper">
                                    <select class="form-input form-select" id="jobTitle" onchange="calculateContract()">
                                        <option value="MD">MD (Medical Doctor)</option>
                                        <option value="CRNA">CRNA (Certified Registered Nurse Anesthetist)</option>
                                        <option value="NP">NP (Nurse Practitioner)</option>
                                        <option value="PA">PA (Physician Assistant)</option>
                                        <option value="RN">RN (Registered Nurse)</option>
                                        <option value="AA">AA (Anesthesiologist Assistant)</option>
                                        <option value="Tech">Tech (Medical Technician)</option>
                                    </select>
                                    <div class="tooltip">Select your professional title. This helps us calculate industry-standard rates and compare against relevant benchmarks for your specialty.</div>
                                </div>
                            </div>


                            <!-- Hourly Rate (Simplified) -->
                            <div class="form-group">
                                <label class="form-label">Hourly Rate ($)</label>
                                <div class="tooltip-wrapper">
                                    <input type="number" class="form-input" id="hourlyRate" value="85" min="0.01" step="0.01" oninput="calculateContract()" onkeyup="calculateContract()" onchange="calculateContract()" placeholder="Enter hourly rate" required>
                                    <div class="tooltip">Enter your base hourly rate before overtime. This is the standard rate you'll be paid for regular hours worked. Does not include overtime premiums or stipends.</div>
                                </div>
                                <div class="form-help">Base hourly rate</div>
                            </div>

                            <!-- Schedule -->
                            <div class="input-group">
                                <div class="form-group">
                                    <label class="form-label">Hours per Week</label>
                                    <div class="tooltip-wrapper">
                                        <input type="number" class="form-input" id="hoursPerWeek" value="40" min="0.01" max="168" step="0.5" oninput="calculateContract()" onkeyup="calculateContract()" onchange="calculateContract()" placeholder="Enter hours per week" required>
                                        <div class="tooltip">Enter the total number of hours you'll work per week at the standard hourly rate. This typically ranges from 36-48 hours for most locum positions. Maximum allowed is 168 hours (24 hours × 7 days).</div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Contract Length (weeks)</label>
                                    <div class="tooltip-wrapper">
                                        <input type="number" class="form-input" id="contractWeeks" value="13" min="1" max="52" step="1" oninput="calculateContract()" onkeyup="calculateContract()" onchange="calculateContract()" placeholder="Enter contract length" required>
                                        <div class="tooltip">Enter the total duration of your contract in weeks. Common lengths are 8-13 weeks for locum tenens assignments, with some extending to 26 or 52 weeks. This determines your total earning potential.</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Stipends -->
                            <div class="form-group">
                                <label class="form-label">Housing Stipend ($ per week)</label>
                                <div class="tooltip-wrapper">
                                    <input type="number" class="form-input" id="housingStipend" value="1200" min="0" step="0.01" oninput="calculateContract()">
                                    <div class="tooltip">Enter the weekly housing allowance provided by your employer. This can range from $800-2000+ per week depending on location and housing type. May be provided as furnished housing or cash allowance.</div>
                                </div>
                                <div class="form-help">Weekly housing allowance</div>
                            </div>

                            <div class="input-group">
                                <div class="form-group">
                                    <label class="form-label">Travel Reimbursement ($)</label>
                                    <div class="tooltip-wrapper">
                                        <input type="number" class="form-input" id="travelReimbursement" value="1000" min="0" step="0.01" oninput="calculateContract()">
                                        <div class="tooltip">Enter the total travel reimbursement amount provided. This covers transportation costs to/from your assignment location and is typically a one-time payment ranging from $500-2000+ depending on distance.</div>
                                    </div>
                                    <div class="form-help">One-time travel allowance</div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Other Stipends ($)</label>
                                    <div class="tooltip-wrapper">
                                        <input type="number" class="form-input" id="otherStipends" value="2000" min="0" step="0.01" oninput="calculateContract()">
                                        <div class="tooltip">Enter total amount for additional benefits like meal stipends, CME allowances, license reimbursement, malpractice insurance, or completion bonuses. This varies widely by employer and contract type.</div>
                                    </div>
                                    <div class="form-help">Total other benefits</div>
                                </div>
                            </div>



                            <!-- Contract Type and State -->
                            <div class="input-group">
                                <div class="form-group">
                                    <label class="form-label">Contract Type</label>
                                    <div class="tooltip-wrapper">
                                        <select class="form-input form-select" id="contractType" onchange="calculateContract()">
                                            <option value="locum">Locum Tenens</option>
                                            <option value="permanent">Permanent Placement</option>
                                            <option value="per-diem">Per Diem</option>
                                        </select>
                                        <div class="tooltip">Select your contract type. Locum Tenens are temporary assignments with higher rates, Permanent Placement offers stability with benefits, and Per Diem provides flexible scheduling with variable hours.</div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Contract State</label>
                                    <div class="tooltip-wrapper">
                                        <select class="form-input form-select" id="workState" onchange="calculateContract()">
                                        <option value="">Select State</option>
                                        <option value="AL">Alabama</option>
                                        <option value="AK">Alaska</option>
                                        <option value="AZ">Arizona</option>
                                        <option value="AR">Arkansas</option>
                                        <option value="CA">California</option>
                                        <option value="CO">Colorado</option>
                                        <option value="CT">Connecticut</option>
                                        <option value="DE">Delaware</option>
                                        <option value="FL">Florida</option>
                                        <option value="GA">Georgia</option>
                                        <option value="HI">Hawaii</option>
                                        <option value="ID">Idaho</option>
                                        <option value="IL">Illinois</option>
                                        <option value="IN">Indiana</option>
                                        <option value="IA">Iowa</option>
                                        <option value="KS">Kansas</option>
                                        <option value="KY">Kentucky</option>
                                        <option value="LA">Louisiana</option>
                                        <option value="ME">Maine</option>
                                        <option value="MD">Maryland</option>
                                        <option value="MA">Massachusetts</option>
                                        <option value="MI">Michigan</option>
                                        <option value="MN">Minnesota</option>
                                        <option value="MS">Mississippi</option>
                                        <option value="MO">Missouri</option>
                                        <option value="MT">Montana</option>
                                        <option value="NE">Nebraska</option>
                                        <option value="NV">Nevada</option>
                                        <option value="NH">New Hampshire</option>
                                        <option value="NJ">New Jersey</option>
                                        <option value="NM">New Mexico</option>
                                        <option value="NY">New York</option>
                                        <option value="NC">North Carolina</option>
                                        <option value="ND">North Dakota</option>
                                        <option value="OH">Ohio</option>
                                        <option value="OK">Oklahoma</option>
                                        <option value="OR">Oregon</option>
                                        <option value="PA">Pennsylvania</option>
                                        <option value="RI">Rhode Island</option>
                                        <option value="SC">South Carolina</option>
                                        <option value="SD">South Dakota</option>
                                        <option value="TN">Tennessee</option>
                                        <option value="TX">Texas</option>
                                        <option value="UT">Utah</option>
                                        <option value="VT">Vermont</option>
                                        <option value="VA">Virginia</option>
                                        <option value="WA">Washington</option>
                                        <option value="WV">West Virginia</option>
                                        <option value="WI">Wisconsin</option>
                                        <option value="WY">Wyoming</option>
                                        </select>
                                        <div class="tooltip">Select the state where you'll be working. This information helps with location-specific market rate comparisons and may affect certain calculations or compliance requirements.</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Results -->
                        <div class="calculator-results">
                            <h2 class="section-title">Contract Analysis</h2>
                            
                            <div class="results-summary">
                                <h3>Total Contract Value</h3>
                                <div class="amount" id="totalContractValue">$0</div>
                                <div class="rate">True Hourly Rate: <span id="trueHourlyRate">$0.00</span></div>
                            </div>

                            <div class="results-breakdown">
                                <div class="result-item">
                                    <div>
                                        <span class="result-label">Regular Pay</span>
                                        <div class="result-subtext">40 hrs/week × $350/hr</div>
                                    </div>
                                    <span class="result-value" id="regularPay">$0</span>
                                </div>
                                <div class="result-item">
                                    <div>
                                        <span class="result-label">Weekly Gross Pay</span>
                                        <div class="result-subtext">Gross income per week</div>
                                    </div>
                                    <span class="result-value" id="weeklyGrossPay">$0.00</span>
                                </div>
                                <div class="result-item highlight">
                                    <div>
                                        <span class="result-label">Total Contract Value</span>
                                        <div class="result-subtext">Total gross earnings</div>
                                    </div>
                                    <span class="result-value" id="totalGrossContract">$0</span>
                                </div>
                                <div class="result-item">
                                    <div>
                                        <span class="result-label">Housing Stipend</span>
                                        <div class="result-subtext">Weekly housing allowance</div>
                                    </div>
                                    <span class="result-value" id="totalHousingStipend">$0</span>
                                </div>
                                <div class="result-item">
                                    <div>
                                        <span class="result-label">Travel Reimbursement</span>
                                        <div class="result-subtext">Travel expenses</div>
                                    </div>
                                    <span class="result-value" id="travelReimbursementDisplay">$0</span>
                                </div>
                                <div class="result-item">
                                    <div>
                                        <span class="result-label">Other Stipends</span>
                                        <div class="result-subtext">Meals, misc allowances</div>
                                    </div>
                                    <span class="result-value" id="otherStipendsDisplay">$0</span>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn-primary" onclick="saveContract()" title="Save for later comparison">📁 Save Analysis <span style="font-size: 0.8em;">(Login Required)</span></button>
                                <button class="btn-secondary" onclick="compareContracts()" title="Compare with saved contracts">📊 Compare <span style="font-size: 0.8em;">(Requires Saved)</span></button>
                                <button class="btn-secondary" onclick="viewHistory()" title="View saved contract history">📋 View History <span style="font-size: 0.8em;">(Login Required)</span></button>
                                <button class="btn-accent" onclick="findSimilarJobs()">🔍 Find Similar Jobs</button>
                                <button id="printButton" class="btn-secondary" onclick="printResults()">🖨️ Print Results</button>
                                <button id="exportPdfButton" class="btn-secondary" onclick="exportAnalysis()">📄 Export PDF</button>
                                <button id="exportCsvButton" class="btn-secondary" onclick="exportCSV()">📊 Export CSV</button>
                                <button id="emailButton" class="btn-secondary" onclick="emailResults()">📧 Email Results</button>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Section -->
                    <div class="comparison-section">
                        <h3 class="section-title">Contract Comparison</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Compare this contract with industry averages and your saved contracts</p>
                        
                        <div class="comparison-grid">
                            <div class="comparison-card">
                                <h4>Your Contract</h4>
                                <div class="comparison-value" id="yourContractRate">$0.00</div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">True Hourly Rate</p>
                            </div>
                            <div class="comparison-card">
                                <h4>Market Average</h4>
                                <div class="comparison-value">$385.00</div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">EM Specialists</p>
                            </div>
                            <div class="comparison-card">
                                <h4>Your Previous</h4>
                                <div class="comparison-value">$422.50</div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Last Contract</p>
                            </div>
                            <div class="comparison-card">
                                <h4>Annual Equivalent</h4>
                                <div class="comparison-value" id="annualEquivalent">$0</div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">If worked year-round</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-container">
                    <div class="footer-section">
                        <h4>LocumTrueRate</h4>
                        <p>Empowering healthcare professionals with accurate contract analysis and job matching.</p>
                    </div>
                    <div class="footer-section">
                        <h5>Tools</h5>
                        <ul>
                            <li><a href="paycheck-calculator.html">Paycheck Calculator</a></li>
                            <li><a href="contract-calculator.html">Contract Calculator</a></li>
                            <li><a href="job-board.html">Job Board</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h5>Support</h5>
                        <ul>
                            <li><a href="#">Help Center</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                        </ul>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 LocumTrueRate. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Removed complex validation - using simple real-time calculations only
        
        // Check if all required fields are valid
        function areAllFieldsValid() {
            console.log('🔍 areAllFieldsValid() called');
            const requiredFields = ['hourlyRate', 'hoursPerWeek', 'contractWeeks'];
            let allValid = true;
            
            requiredFields.forEach(fieldId => {
                const input = document.getElementById(fieldId);
                if (!input) {
                    console.error(`❌ VALIDATION FAILED: Required field element not found: ${fieldId}`);
                    allValid = false;
                    return;
                }
                
                const value = parseFloat(input.value.trim());
                let isValid = !isNaN(value) && value > 0;
                
                // Special validation for specific fields
                if (fieldId === 'hoursPerWeek' && value > 168) {
                    isValid = false;
                    console.error(`❌ VALIDATION FAILED: ${fieldId} = ${value} (exceeds 168 hours/week)`);
                } else if (fieldId === 'contractWeeks' && value > 52) {
                    console.warn(`⚠️ WARNING: ${fieldId} = ${value} (exceeds 52 weeks)`);
                } else if (!isValid) {
                    console.error(`❌ VALIDATION FAILED: ${fieldId} = ${value} (must be > 0)`);
                }
                
                if (!isValid) allValid = false;
            });
            
            console.log(allValid ? '✅ All fields are valid' : '❌ Some fields failed validation');
            return allValid;
        }
        
        // Clear results when validation fails
        function clearResults() {
            const resultElements = [
                'regularPay', 'weeklyGrossPay', 
                'grossTaxableIncome', 'totalHousingStipend', 'otherStipends', 
                'netTakeHome', 'totalContractValue', 
                'trueHourlyRate', 'yourContractRate', 'annualEquivalent'
            ];
            
            resultElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = '$0';
                }
            });
        }
        
        // Update button states based on validation
        function updateButtonStates() {
            const isValid = areAllFieldsValid();
            const hasCalculatedResults = parseFloat(document.getElementById('totalContractValue').textContent.replace(/[$,]/g, '')) > 0;
            
            // Save and Compare buttons require valid fields
            const saveBtn = document.querySelector('.btn-primary[onclick="saveContract()"]');
            const compareBtn = document.querySelector('.btn-secondary[onclick="compareContracts()"]');
            const findJobsBtn = document.querySelector('.btn-accent[onclick="findSimilarJobs()"]');
            
            if (saveBtn) saveBtn.disabled = !isValid;
            if (compareBtn) compareBtn.disabled = !isValid;
            if (findJobsBtn) findJobsBtn.disabled = !isValid;
            
            // Export, Print, Email buttons enabled if we have calculated results
            const exportBtn = document.getElementById('exportPdfButton');
            const exportCSVBtn = document.getElementById('exportCsvButton');
            const printBtn = document.getElementById('printButton');
            const emailBtn = document.getElementById('emailButton');
            
            if (exportBtn) exportBtn.disabled = !hasCalculatedResults;
            if (exportCSVBtn) exportCSVBtn.disabled = !hasCalculatedResults;
            if (printBtn) printBtn.disabled = !hasCalculatedResults;
            if (emailBtn) emailBtn.disabled = !hasCalculatedResults;
        }

        function calculateContract() {
            console.log('🔄 calculateContract() called');
            console.log('🔍 Checking if DOM is ready...');
            
            // Check if elements exist
            const inputElementIds = ['hourlyRate', 'hoursPerWeek', 'contractWeeks', 'housingStipend', 'travelReimbursement', 'otherStipends'];
            for (const id of inputElementIds) {
                const elem = document.getElementById(id);
                if (!elem) {
                    console.error(`❌ Element not found: ${id}`);
                    return;
                }
            }
            
            console.log('✅ All input elements found');
            console.log('🔄 Calculating contract (simplified gross only)...');
            
            // Get input values - simplified fields only
            console.log('📊 Getting input values...');
            
            const getInputValue = (id, defaultValue = 0) => {
                const elem = document.getElementById(id);
                if (!elem) {
                    console.error(`❌ CRITICAL: Cannot find input element: ${id}`);
                    return defaultValue;
                }
                const value = parseFloat(elem.value) || defaultValue;
                console.log(`🔹 ${id}: ${value}`);
                return value;
            };
            
            const hourlyRate = getInputValue('hourlyRate');
            const hoursPerWeek = getInputValue('hoursPerWeek');
            const contractWeeks = getInputValue('contractWeeks');
            const housingStipend = getInputValue('housingStipend');
            const travelReimbursement = getInputValue('travelReimbursement');
            const otherStipends = getInputValue('otherStipends');
            
            // Log input values for debugging
            console.log(`📊 Inputs: $${hourlyRate}/hr, ${hoursPerWeek} hrs/week, ${contractWeeks} weeks`);
            
            // Validation with visible error messages
            let hasErrors = false;
            const validationErrors = [];
            
            if (hourlyRate <= 0) {
                validationErrors.push('Hourly rate must be greater than $0');
                hasErrors = true;
            }
            if (hoursPerWeek <= 0) {
                validationErrors.push('Hours per week must be greater than 0');
                hasErrors = true;
            }
            if (hoursPerWeek > 168) {
                validationErrors.push('Hours per week cannot exceed 168');
                hasErrors = true;
            }
            if (contractWeeks <= 0) {
                validationErrors.push('Contract length must be at least 1 week');
                hasErrors = true;
            }
            if (contractWeeks > 52) {
                console.warn('⚠️ Contract length over 1 year');
            }
            if (travelReimbursement < 0 || otherStipends < 0 || housingStipend < 0) {
                validationErrors.push('Values cannot be negative');
                hasErrors = true;
            }
            
            // Show validation errors
            if (hasErrors) {
                console.error('❌ Validation errors:', validationErrors);
                // Show first error as notification
                if (typeof showNotification === 'function' && validationErrors.length > 0) {
                    showNotification(`❌ ${validationErrors[0]}`, 'error');
                }
            }
            
            // Simple gross calculations only
            const weeklyGrossPay = hourlyRate * hoursPerWeek;
            const totalGrossPay = weeklyGrossPay * contractWeeks;
            const totalHousingStipend = housingStipend * contractWeeks;
            const totalContractValue = totalGrossPay + totalHousingStipend + travelReimbursement + otherStipends;
            
            // True hourly rate calculation
            const totalHours = hoursPerWeek * contractWeeks;
            const trueHourlyRate = totalHours > 0 ? totalContractValue / totalHours : 0;
            
            // Annual equivalent (52 weeks)
            const annualEquivalent = trueHourlyRate * hoursPerWeek * 52;

            // Update display elements - only update elements that exist
            const elements = {
                'regularPay': '$' + totalGrossPay.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}),
                'weeklyGrossPay': '$' + weeklyGrossPay.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}),
                'totalContractValue': '$' + totalContractValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}),
                'totalGrossContract': '$' + totalContractValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}),
                'totalHousingStipend': '$' + totalHousingStipend.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}),
                'travelReimbursementDisplay': '$' + travelReimbursement.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}),
                'otherStipendsDisplay': '$' + otherStipends.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}),
                'otherStipends': '$' + (travelReimbursement + otherStipends).toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}),
                'netTakeHome': '$' + totalContractValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}),
                'trueHourlyRate': '$' + trueHourlyRate.toFixed(2),
                'yourContractRate': '$' + trueHourlyRate.toFixed(2),
                'annualEquivalent': '$' + annualEquivalent.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})
            };

            // Safely update each element
            console.log('📊 Updating result display elements...');
            const failedUpdates = [];
            Object.keys(elements).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = elements[id];
                    console.log(`✅ Updated ${id}: ${elements[id]}`);
                } else {
                    failedUpdates.push(id);
                    console.error(`❌ FAILED TO UPDATE: Result element not found: ${id}`);
                }
            });
            
            if (failedUpdates.length > 0) {
                console.error(`❌❌❌ CRITICAL: Failed to update ${failedUpdates.length} result elements!`);
                console.error(`Failed elements: ${failedUpdates.join(', ')}`);
                console.error('This is why calculations appear as $0!');
            }
            
            // Log calculation results
            console.log(`📊 Results: Weekly: $${weeklyGrossPay.toFixed(2)}, Total: $${totalContractValue.toFixed(2)}, True Rate: $${trueHourlyRate.toFixed(2)}`);
            
            // Update button states after calculation
            updateButtonStates();
        }

        function saveContract() {
            console.log('💾 saveContract() called');
            // Check for account requirement
            const isLoggedIn = localStorage.getItem('userToken'); // Simulate login check
            if (!isLoggedIn) {
                console.log('💾 User not logged in, showing guest modal');
                showGuestLoginModal('save');
                return;
            }
            
            // Always allow saving, but warn if validation issues exist
            const hasValidationErrors = !areAllFieldsValid();
            if (hasValidationErrors) {
                showToast('Saving contract with validation errors', 'warning');
            }
            
            const contractData = {
                timestamp: new Date().toISOString(),
                jobTitle: document.getElementById('jobTitle').value,
                hourlyRate: document.getElementById('hourlyRate').value,
                hoursPerWeek: document.getElementById('hoursPerWeek').value,
                contractWeeks: document.getElementById('contractWeeks').value,
                workState: document.getElementById('workState').value,
                totalValue: document.getElementById('totalContractValue').textContent,
                trueHourlyRate: document.getElementById('trueHourlyRate').textContent,
                weeklyGrossPay: document.getElementById('weeklyGrossPay').textContent,
            };

            let savedContracts = JSON.parse(localStorage.getItem('savedContracts') || '[]');
            savedContracts.unshift(contractData);
            savedContracts = savedContracts.slice(0, 10); // Keep only last 10
            localStorage.setItem('savedContracts', JSON.stringify(savedContracts));
            
            console.log('💾 Contract saved successfully:', contractData);
            
            // Show success notification
            showNotification('✅ Contract analysis saved successfully!', 'success');
            
            // Update comparison cards with new data if available
            updateComparisonCards();
        }

        function compareContracts() {
            const isLoggedIn = localStorage.getItem('userToken'); // Simulate login check
            if (!isLoggedIn) {
                showGuestLoginModal('compare');
                return;
            }
            
            const savedContracts = JSON.parse(localStorage.getItem('savedContracts') || '[]');
            if (savedContracts.length === 0) {
                showToast('No saved contracts found. Save this contract first to enable comparisons.', 'info');
                saveContract();
                return;
            }
            
            // Create comparison modal/overlay
            const currentContract = {
                jobTitle: document.getElementById('jobTitle').value,
                trueHourlyRate: document.getElementById('trueHourlyRate').textContent,
                totalValue: document.getElementById('totalContractValue').textContent,
                weeklyGrossPay: document.getElementById('weeklyGrossPay').textContent,
                netTakeHome: document.getElementById('netTakeHome').textContent,
                contractWeeks: document.getElementById('contractWeeks').value,
                hoursPerWeek: document.getElementById('hoursPerWeek').value
            };
            
            // Generate comparison HTML
            const comparisonHTML = `
                <div id="comparison-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">
                    <div style="
                        background: white;
                        padding: 30px;
                        border-radius: 10px;
                        max-width: 90vw;
                        max-height: 90vh;
                        overflow-y: auto;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    ">
                        <h2 style="text-align: center; margin-bottom: 20px; color: #2563eb;">Contract Comparison</h2>
                        
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="padding: 12px; border: 1px solid #e2e8f0;">Metric</th>
                                    <th style="padding: 12px; border: 1px solid #e2e8f0; background: #dbeafe;">Current Contract</th>
                                    ${savedContracts.slice(0, 3).map((contract, index) => 
                                        `<th style="padding: 12px; border: 1px solid #e2e8f0;">Previous ${index + 1}</th>`
                                    ).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: bold;">Position</td>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; background: #f0f9ff;">${currentContract.jobTitle}</td>
                                    ${savedContracts.slice(0, 3).map(contract => 
                                        `<td style="padding: 12px; border: 1px solid #e2e8f0;">${contract.jobTitle}</td>`
                                    ).join('')}
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: bold;">True Hourly Rate</td>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; background: #f0f9ff; font-weight: bold;">${currentContract.trueHourlyRate}</td>
                                    ${savedContracts.slice(0, 3).map(contract => 
                                        `<td style="padding: 12px; border: 1px solid #e2e8f0;">${contract.trueHourlyRate}</td>`
                                    ).join('')}
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: bold;">Total Contract Value</td>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; background: #f0f9ff;">${currentContract.totalValue}</td>
                                    ${savedContracts.slice(0, 3).map(contract => 
                                        `<td style="padding: 12px; border: 1px solid #e2e8f0;">${contract.totalValue}</td>`
                                    ).join('')}
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: bold;">Weekly Gross Pay</td>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; background: #f0f9ff;">${currentContract.weeklyGrossPay}</td>
                                    ${savedContracts.slice(0, 3).map(contract => 
                                        `<td style="padding: 12px; border: 1px solid #e2e8f0;">${contract.weeklyGrossPay || 'N/A'}</td>`
                                    ).join('')}
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: bold;">Contract Length</td>
                                    <td style="padding: 12px; border: 1px solid #e2e8f0; background: #f0f9ff;">${currentContract.contractWeeks} weeks</td>
                                    ${savedContracts.slice(0, 3).map(contract => 
                                        `<td style="padding: 12px; border: 1px solid #e2e8f0;">${contract.contractWeeks || 'N/A'} weeks</td>`
                                    ).join('')}
                                </tr>
                            </tbody>
                        </table>
                        
                        <div style="text-align: center;">
                            <button onclick="closeComparisonModal()" style="
                                background: #2563eb;
                                color: white;
                                padding: 10px 20px;
                                border: none;
                                border-radius: 5px;
                                cursor: pointer;
                                font-size: 16px;
                            ">Close Comparison</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Insert modal into page
            document.body.insertAdjacentHTML('beforeend', comparisonHTML);
        }
        
        function closeComparisonModal() {
            const modal = document.getElementById('comparison-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function viewHistory() {
            const isLoggedIn = localStorage.getItem('userToken'); // Simulate login check
            if (!isLoggedIn) {
                showGuestLoginModal('history');
                return;
            }
            
            const savedContracts = JSON.parse(localStorage.getItem('savedContracts') || '[]');
            if (savedContracts.length === 0) {
                showNotification('No saved contracts found. Save this contract first to view history.', 'info');
                return;
            }
            
            // Generate history HTML
            const historyHTML = `
                <div id="history-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    overflow-y: auto;
                ">
                    <div style="
                        background: white;
                        padding: 30px;
                        border-radius: 12px;
                        max-width: 800px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                        box-shadow: 0 20px 50px rgba(0,0,0,0.3);
                    ">
                        <h2 style="color: #2563eb; margin-bottom: 20px; text-align: center;">📋 Contract History</h2>
                        <div style="margin-bottom: 20px;">
                            ${savedContracts.map((contract, index) => `
                                <div style="
                                    border: 1px solid #e2e8f0;
                                    padding: 15px;
                                    margin-bottom: 10px;
                                    border-radius: 8px;
                                    background: ${index === 0 ? '#f0f9ff' : '#f8fafc'};
                                ">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <h3 style="margin: 0; color: #1e293b;">${contract.jobTitle}</h3>
                                        <span style="color: #6b7280; font-size: 0.9em;">${contract.timestamp}</span>
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                        <div><strong>True Rate:</strong> ${contract.trueHourlyRate}</div>
                                        <div><strong>Total Value:</strong> ${contract.totalValue}</div>
                                        <div><strong>Weekly Pay:</strong> ${contract.weeklyGrossPay}</div>
                                        <div><strong>Contract:</strong> ${contract.contractWeeks} weeks</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="text-align: center;">
                            <button onclick="closeHistoryModal()" style="
                                background: #6b7280;
                                color: white;
                                padding: 10px 20px;
                                border: none;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 14px;
                            ">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', historyHTML);
            showNotification('📋 Contract history loaded', 'success');
        }
        
        function closeHistoryModal() {
            const modal = document.getElementById('history-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Guest login modal for Save/Compare functionality
        function showGuestLoginModal(action) {
            console.log('🔑 showGuestLoginModal() called for action:', action);
            
            const actionText = action === 'save' ? 'save contracts' : 
                              action === 'compare' ? 'compare contracts' : 'view contract history';
            
            // Remove any existing modal first
            const existingModal = document.getElementById('guest-login-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modalHTML = `
                <div id="guest-login-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.7);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    animation: fadeIn 0.3s ease;
                ">
                    <div style="
                        background: white;
                        padding: 40px;
                        border-radius: 12px;
                        max-width: 500px;
                        text-align: center;
                        box-shadow: 0 20px 50px rgba(0,0,0,0.4);
                        transform: translateY(-20px);
                        animation: slideIn 0.3s ease;
                        margin: 20px;
                    ">
                        <h2 style="color: #2563eb; margin-bottom: 20px; font-size: 24px;">🔑 Account Required</h2>
                        <p style="margin-bottom: 25px; color: #6b7280; line-height: 1.6; font-size: 16px;">
                            To ${actionText}, you need a free LocumTrueRate account. Your saved contracts will be available across all your devices.
                        </p>
                        
                        <div style="display: flex; gap: 15px; flex-direction: column;">
                            <button onclick="simulateLogin('${action}')" style="
                                background: #2563eb;
                                color: white;
                                padding: 15px 30px;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 16px;
                                font-weight: 600;
                                transition: background 0.2s;
                            " onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='#2563eb'">🚀 Sign Up Free (Demo)</button>
                            
                            <button onclick="simulateLogin('${action}')" style="
                                background: transparent;
                                color: #2563eb;
                                padding: 15px 30px;
                                border: 2px solid #2563eb;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 16px;
                                font-weight: 600;
                                transition: all 0.2s;
                            " onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">📧 Login (Demo)</button>
                            
                            <button onclick="closeGuestLoginModal()" style="
                                background: transparent;
                                color: #6b7280;
                                padding: 12px 20px;
                                border: none;
                                cursor: pointer;
                                font-size: 14px;
                                transition: color 0.2s;
                            " onmouseover="this.style.color='#374151'" onmouseout="this.style.color='#6b7280'">Maybe Later</button>
                        </div>
                        
                        <p style="margin-top: 20px; font-size: 12px; color: #9ca3af; border-top: 1px solid #e5e7eb; padding-top: 15px;">
                            <strong>Free forever:</strong> Save unlimited contracts, compare offers, export analyses
                        </p>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Add CSS animations if not already present
            if (!document.getElementById('modal-animations')) {
                const style = document.createElement('style');
                style.id = 'modal-animations';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideIn {
                        from { transform: translateY(-30px); opacity: 0; }
                        to { transform: translateY(-20px); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            console.log('🔑 Guest login modal displayed');
            showNotification('🔑 Login required to ' + actionText, 'info');
        }
        
        function closeGuestLoginModal() {
            const modal = document.getElementById('guest-login-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function simulateLogin(action) {
            console.log('🔑 simulateLogin() called for action:', action);
            // Simulate login process
            showNotification('🔑 Logging in...', 'info');
            
            setTimeout(() => {
                localStorage.setItem('userToken', 'demo-token-12345');
                localStorage.setItem('userName', 'Demo User');
                showNotification('✅ Successfully logged in as Demo User!', 'success');
                closeGuestLoginModal();
                
                console.log('🔑 Login complete, processing action:', action);
                
                // Execute the original action after login
                setTimeout(() => {
                    if (action === 'save') {
                        saveContract();
                    } else if (action === 'compare') {
                        compareContracts();
                    } else if (action === 'history') {
                        viewHistory();
                    }
                }, 500);
                
                // Update button states
                updateButtonStates();
                
                // Show welcome message
                setTimeout(() => {
                    showNotification('💡 You can now save and compare contracts!', 'info');
                }, 1500);
                
            }, 1000);
        }

        function findSimilarJobs() {
            const jobTitle = document.getElementById('jobTitle').value;
            const hourlyRate = document.getElementById('hourlyRate').value;
            
            // Simulate finding similar jobs
            alert(`Finding similar ${jobTitle} positions with rates near $${hourlyRate}/hr...\n\nRedirecting to job board with filters applied.`);
            
            setTimeout(() => {
                window.location.href = 'job-board.html#similar-jobs';
            }, 1000);
        }

        // Print Results function with better fallback handling
        function printResults() {
            console.log('🖨️ printResults() called');
            try {
                // Safe get value function
                const safeGetValue = (id) => {
                    const element = document.getElementById(id);
                    if (!element) {
                        console.error(`❌ Print: Missing element: ${id}`);
                        return 'N/A';
                    }
                    return element.value || element.textContent || 'N/A';
                };
                
                // Direct print function (most reliable fallback)
                const printCurrentPage = () => {
                    console.log('🖨️ Using direct browser print');
                    try {
                        window.print();
                        showNotification('🖨️ Print dialog opened for current page', 'success');
                    } catch (printErr) {
                        console.error('❌ Direct print failed:', printErr);
                        showNotification('⚠️ Print failed. Use Ctrl+P (Cmd+P on Mac) manually.', 'error');
                    }
                };
                
                // Try to create a proper print version
                try {
                    console.log('🖨️ Creating print content');
                    
                    // Create enhanced print content
                    const printContent = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Contract Analysis - ${safeGetValue('jobTitle')}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; color: #333; line-height: 1.4; }
        h1 { color: #2563eb; text-align: center; margin-bottom: 20px; }
        .summary { background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .results { display: grid; gap: 10px; margin-bottom: 20px; }
        .result-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; }
        .total { font-weight: bold; font-size: 1.1em; background-color: #e0f2fe; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f3f4f6; font-weight: 600; }
        @media print { 
            body { margin: 0; -webkit-print-color-adjust: exact; color-adjust: exact; }
            .summary { background: #f8fafc !important; }
            .total { background-color: #e0f2fe !important; }
        }
        @page { margin: 1in; }
    </style>
</head>
<body>
    <h1>Contract Analysis Report</h1>
    <div class="summary">
        <h3>Contract Details</h3>
        <table>
            <tr><td><strong>Position:</strong></td><td>${safeGetValue('jobTitle')}</td></tr>
            <tr><td><strong>Contract Length:</strong></td><td>${safeGetValue('contractWeeks')} weeks</td></tr>
            <tr><td><strong>Hours per Week:</strong></td><td>${safeGetValue('hoursPerWeek')}</td></tr>
            <tr><td><strong>Hourly Rate:</strong></td><td>$${safeGetValue('hourlyRate')}</td></tr>
            <tr><td><strong>Housing Stipend:</strong></td><td>$${safeGetValue('housingStipend')}/week</td></tr>
        </table>
        <p><strong>Generated:</strong> ${new Date().toLocaleDateString()}</p>
    </div>
    <div class="results">
        <h3>Financial Summary</h3>
        <div class="result-row total"><span>Total Contract Value:</span><span>${safeGetValue('totalContractValue')}</span></div>
        <div class="result-row total"><span>True Hourly Rate:</span><span>${safeGetValue('trueHourlyRate')}</span></div>
        <div class="result-row"><span>Weekly Gross Pay:</span><span>${safeGetValue('weeklyGrossPay')}</span></div>
        <div class="result-row"><span>Total Housing Stipend:</span><span>${safeGetValue('totalHousingStipend')}</span></div>
        <div class="result-row"><span>Annual Equivalent:</span><span>${safeGetValue('annualEquivalent')}</span></div>
    </div>
    <div style="margin-top: 30px; padding-top: 15px; border-top: 1px solid #ccc; font-size: 0.9em; color: #666;">
        <p>Generated by LocumTrueRate Contract Calculator</p>
        <p><em>This analysis is for informational purposes only.</em></p>
    </div>
</body>
</html>`;
                    
                    console.log('🖨️ Print content prepared');
                    
                    // Try to open print window
                    let printWindow = null;
                    try {
                        printWindow = window.open('', '_blank', 'width=900,height=700,scrollbars=yes');
                    } catch (popupError) {
                        console.log('🖨️ Popup blocked, using direct print fallback');
                        printCurrentPage();
                        return;
                    }
                    
                    if (printWindow && !printWindow.closed) {
                        console.log('🖨️ Print window opened successfully');
                        
                        printWindow.document.write(printContent);
                        printWindow.document.close();
                        printWindow.focus();
                        
                        // Auto-trigger print dialog with better error handling
                        setTimeout(() => {
                            try {
                                printWindow.print();
                                console.log('🖨️ Print dialog triggered');
                                
                                // Handle print completion
                                printWindow.onafterprint = function() {
                                    console.log('🖨️ Print completed, closing window');
                                    try {
                                        printWindow.close();
                                    } catch (closeErr) {
                                        console.log('🖨️ Window close failed (may already be closed)');
                                    }
                                };
                                
                                // Fallback to close window after 30 seconds
                                setTimeout(() => {
                                    if (printWindow && !printWindow.closed) {
                                        try {
                                            printWindow.close();
                                            console.log('🖨️ Print window closed after timeout');
                                        } catch (timeoutCloseErr) {
                                            console.log('🖨️ Timeout close failed');
                                        }
                                    }
                                }, 30000);
                                
                            } catch (printErr) {
                                console.error('🖨️ Print dialog failed:', printErr);
                                if (printWindow && !printWindow.closed) {
                                    printWindow.close();
                                }
                                printCurrentPage();
                            }
                        }, 750);
                        
                        showNotification('🖨️ Print dialog opened in new window', 'success');
                        
                    } else {
                        console.log('🖨️ Print window blocked or failed to open');
                        showNotification('⚠️ Pop-ups blocked. Using current page print...', 'info');
                        setTimeout(printCurrentPage, 500);
                    }
                    
                } catch (contentError) {
                    console.error('🖨️ Error creating print content:', contentError);
                    printCurrentPage();
                }
                
            } catch (error) {
                console.error('❌ Print error:', error);
                showNotification('⚠️ Print failed: ' + error.message + '. Use Ctrl+P manually.', 'error');
            }
        }
        
        // Print Results function (DUPLICATE - COMMENTED OUT)
        // function printResults() {
            try {
                // Create a print-friendly version of the results
                const printWindow = window.open('', '_blank', 'width=800,height=600');
                
                const printContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Contract Analysis - ${document.getElementById('jobTitle').value}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
                            .header { border-bottom: 2px solid #2563eb; padding-bottom: 10px; margin-bottom: 20px; }
                            .contract-details { margin-bottom: 20px; }
                            .results-section { margin-bottom: 20px; }
                            .result-item { margin: 5px 0; padding: 8px; background: #f8f9fa; border-radius: 4px; }
                            .result-label { font-weight: bold; color: #2563eb; }
                            .result-value { float: right; font-weight: bold; }
                            .footer { margin-top: 30px; padding-top: 15px; border-top: 1px solid #ccc; font-size: 0.9em; color: #666; }
                            @media print { 
                                body { margin: 0; }
                                .no-print { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>Contract Analysis Report</h1>
                            <p>Generated: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
                        </div>
                        
                        <div class="contract-details">
                            <h2>Contract Details</h2>
                            <div class="result-item">
                                <span class="result-label">Position:</span>
                                <span class="result-value">${document.getElementById('jobTitle').value}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Hourly Rate:</span>
                                <span class="result-value">$${document.getElementById('hourlyRate').value}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Hours per Week:</span>
                                <span class="result-value">${document.getElementById('hoursPerWeek').value}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Contract Length:</span>
                                <span class="result-value">${document.getElementById('contractWeeks').value} weeks</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Housing Stipend:</span>
                                <span class="result-value">$${document.getElementById('housingStipend').value}/week</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Travel Reimbursement:</span>
                                <span class="result-value">$${document.getElementById('travelReimbursement').value}</span>
                            </div>
                        </div>
                        
                        <div class="results-section">
                            <h2>Financial Analysis</h2>
                            <div class="result-item">
                                <span class="result-label">Weekly Gross Pay:</span>
                                <span class="result-value">${document.getElementById('weeklyGrossPay').textContent}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Total Contract Value:</span>
                                <span class="result-value">${document.getElementById('totalContractValue').textContent}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">True Hourly Rate:</span>
                                <span class="result-value">${document.getElementById('trueHourlyRate').textContent}</span>
                            </div>
                            
                        </div>
                        
                        <div class="footer">
                            <p>This analysis was generated using LocumTrueRate Contract Calculator</p>
                            <p>Visit <strong>locumtruerate.com</strong> for more tools and job opportunities</p>
                        </div>
                    </body>
                    </html>
                `;
                
                printWindow.document.write(printContent);
                printWindow.document.close();
                
                // Wait for content to load, then print
                printWindow.onload = function() {
                    printWindow.print();
                };
                
                showNotification('🖨️ Print dialog opened', 'success');
                
            } catch (error) {
                console.error('Print error:', error);
                showNotification('⚠️ Print failed. Please use Ctrl+P to print manually.', 'error');
            }
        // } // END OF DUPLICATE FUNCTION
        
        // Email Results function with better fallback handling
        function emailResults() {
            console.log('📧 emailResults() called');
            try {
                // Safe get value function
                const safeGetValue = (id) => {
                    const element = document.getElementById(id);
                    if (!element) {
                        console.error(`❌ Email: Missing element: ${id}`);
                        return 'N/A';
                    }
                    return element.value || element.textContent || 'N/A';
                };
                
                const jobTitle = safeGetValue('jobTitle');
                const subject = `Contract Analysis - ${jobTitle}`;
                
                // Create comprehensive email body
                const body = `Contract Analysis Summary

Position: ${jobTitle}
Contract Duration: ${safeGetValue('contractWeeks')} weeks
Hours per Week: ${safeGetValue('hoursPerWeek')}
Hourly Rate: $${safeGetValue('hourlyRate')}

BENEFITS:
Housing Stipend: $${safeGetValue('housingStipend')}/week
Travel Reimbursement: $${safeGetValue('travelReimbursement')}
Other Stipends: $${safeGetValue('otherStipends')}

FINANCIAL SUMMARY:
Total Contract Value: ${safeGetValue('totalContractValue')}
True Hourly Rate: ${safeGetValue('trueHourlyRate')}
Weekly Gross Pay: ${safeGetValue('weeklyGrossPay')}
Total Housing Stipend: ${safeGetValue('totalHousingStipend')}
Annual Equivalent: ${safeGetValue('annualEquivalent')}

Generated: ${new Date().toLocaleDateString()}

From: LocumTrueRate Contract Calculator
---
This analysis is for informational purposes only. Consult with financial advisors for tax planning.`;
                    
                console.log('📧 Email content prepared');
                
                // Try multiple email approaches
                const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                
                // Method 1: Try direct mailto link
                try {
                    const link = document.createElement('a');
                    link.href = mailtoLink;
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    console.log('📧 Mailto link triggered');
                    showNotification('📧 Opening email client...', 'info');
                    
                    // Provide fallback instructions with improved UX
                    setTimeout(() => {
                        const fallbackText = `If your email client didn't open, here's your analysis:

${body}`;
                        
                        // Try to copy to clipboard as backup
                        if (navigator.clipboard && navigator.clipboard.writeText) {
                            navigator.clipboard.writeText(fallbackText).then(() => {
                                showNotification('📋 Analysis copied to clipboard! Paste into your email.', 'success');
                                console.log('📧 Email content copied to clipboard');
                            }).catch(clipErr => {
                                console.log('📧 Clipboard copy failed:', clipErr);
                                showEmailFallback(fallbackText);
                            });
                        } else {
                            showEmailFallback(fallbackText);
                        }
                    }, 2000);
                    
                } catch (linkError) {
                    console.error('📧 Mailto link failed:', linkError);
                    showEmailFallback(body);
                }
                
                // Function to show fallback modal/notification
                function showEmailFallback(content) {
                    showNotification('💡 Email client may not be configured. Check console for text to copy.', 'info');
                    console.log('📧 EMAIL CONTENT TO COPY:');
                    console.log('Subject:', subject);
                    console.log('Body:', content);
                    
                    // Also show in a more accessible way
                    setTimeout(() => {
                        showNotification('📋 Check browser Developer Console (F12) for email content to copy', 'info');
                    }, 3000);
                }
                
            } catch (error) {
                console.error('❌ Email error:', error);
                showNotification('⚠️ Email failed: ' + error.message + '. Check console for content to copy.', 'error');
                
                // At minimum, log the content so user can copy it
                console.log('📧 FALLBACK EMAIL CONTENT:');
                console.log('Subject: Contract Analysis');
                console.log('Body: Check the results above and copy manually');
            }
        }
        
        // Export CSV function with better error handling
        function exportCSV() {
            console.log('📊 exportCSV() called');
            try {
                // First, ensure all input and result elements exist
                const requiredElements = [
                    'jobTitle', 'contractType', 'workState', 'hourlyRate', 
                    'hoursPerWeek', 'contractWeeks', 'housingStipend',
                    'travelReimbursement', 'otherStipends', 'totalContractValue',
                    'trueHourlyRate', 'weeklyGrossPay', 'totalHousingStipend',
                    'annualEquivalent'
                ];
                
                // Check if elements exist and get safe values
                const safeGetValue = (id) => {
                    const element = document.getElementById(id);
                    if (!element) {
                        console.error(`❌ CSV Export: Missing element: ${id}`);
                        return 'N/A';
                    }
                    return element.value || element.textContent || 'N/A';
                };
                
                const safeGetSelectText = (id) => {
                    const element = document.getElementById(id);
                    if (!element || !element.options || !element.selectedIndex) {
                        console.error(`❌ CSV Export: Missing select element: ${id}`);
                        return 'N/A';
                    }
                    return element.options[element.selectedIndex].text || 'N/A';
                };
                
                // Gather all data for CSV export with safe access
                const data = [
                    ['Contract Analysis Report'],
                    ['Generated', new Date().toLocaleDateString()],
                    [],
                    ['Contract Details'],
                    ['Position', safeGetValue('jobTitle')],
                    ['Contract Type', safeGetValue('contractType')],
                    ['Work State', safeGetSelectText('workState')],
                    [],
                    ['Contract Terms'],
                    ['Hourly Rate', safeGetValue('hourlyRate')],
                    ['Hours per Week', safeGetValue('hoursPerWeek')],
                    ['Contract Weeks', safeGetValue('contractWeeks')],
                    [],
                    ['Benefits'],
                    ['Housing Stipend (Weekly)', safeGetValue('housingStipend')],
                    ['Travel Reimbursement', safeGetValue('travelReimbursement')],
                    ['Other Stipends', safeGetValue('otherStipends')],
                    [],
                    ['Gross Calculation Results'],
                    ['Total Contract Value', safeGetValue('totalContractValue')],
                    ['True Hourly Rate', safeGetValue('trueHourlyRate')],
                    ['Weekly Gross Pay', safeGetValue('weeklyGrossPay')],
                    ['Total Housing Stipend', safeGetValue('totalHousingStipend')],
                    ['Annual Equivalent', safeGetValue('annualEquivalent')]
                ];
                
                console.log('📊 CSV data prepared:', data.length, 'rows');
                
                // Convert data to CSV format
                const csvContent = data.map(row => 
                    row.map(cell => {
                        // Escape quotes and wrap in quotes if contains comma
                        const cellStr = String(cell || '');
                        if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                            return '"' + cellStr.replace(/"/g, '""') + '"';
                        }
                        return cellStr;
                    }).join(',')
                ).join('\n');
                
                console.log('📊 CSV content generated, length:', csvContent.length);
                
                // Check browser support
                if (!window.URL || !window.URL.createObjectURL) {
                    throw new Error('Browser does not support file downloads');
                }
                
                // Create and download CSV file
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.setAttribute('href', url);
                
                // Create safe filename
                const jobTitle = safeGetValue('jobTitle').replace(/[^a-z0-9]/gi, '_').toLowerCase() || 'contract';
                const dateStr = new Date().toISOString().split('T')[0];
                const filename = `contract_analysis_${jobTitle}_${dateStr}.csv`;
                
                link.setAttribute('download', filename);
                link.style.display = 'none';
                
                console.log('📊 Triggering CSV download:', filename);
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up the URL after download
                setTimeout(() => {
                    URL.revokeObjectURL(url);
                    console.log('📊 CSV URL cleaned up');
                }, 1000);
                
                showNotification('📊 CSV file downloaded successfully: ' + filename, 'success');
                
            } catch (error) {
                console.error('❌ CSV export error:', error);
                showNotification('⚠️ CSV export failed: ' + error.message, 'error');
            }
        }

        function exportAnalysis() {
            console.log('📄 exportAnalysis() called');
            try {
                // Safe get value function
                const safeGetValue = (id) => {
                    const element = document.getElementById(id);
                    if (!element) {
                        console.error(`❌ PDF Export: Missing element: ${id}`);
                        return 'N/A';
                    }
                    return element.value || element.textContent || 'N/A';
                };
                
                // Generate comprehensive contract analysis for PDF export
                const analysis = {
                    jobTitle: safeGetValue('jobTitle'),
                    hourlyRate: safeGetValue('hourlyRate'),
                    hoursPerWeek: safeGetValue('hoursPerWeek'),
                    contractWeeks: safeGetValue('contractWeeks'),
                    housingStipend: safeGetValue('housingStipend'),
                    travelReimbursement: safeGetValue('travelReimbursement'),
                    otherStipends: safeGetValue('otherStipends'),
                    totalValue: safeGetValue('totalContractValue'),
                    trueHourlyRate: safeGetValue('trueHourlyRate'),
                    weeklyGrossPay: safeGetValue('weeklyGrossPay'),
                    totalHousingStipend: safeGetValue('totalHousingStipend'),
                    annualEquivalent: safeGetValue('annualEquivalent'),
                    timestamp: new Date().toLocaleDateString()
                };
                
                console.log('📄 PDF data prepared:', analysis);
                
                // Create HTML content for PDF that will be downloadable
                const pdfContent = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Contract Analysis - ${analysis.jobTitle}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; color: #333; line-height: 1.5; }
        h1 { color: #2563eb; text-align: center; margin-bottom: 30px; }
        h2 { color: #1e293b; margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid #e2e8f0; padding-bottom: 5px; }
        .header-info { background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .summary-card { border: 1px solid #e2e8f0; padding: 20px; border-radius: 8px; text-align: center; }
        .summary-card h3 { margin: 0 0 10px; color: #6b7280; font-size: 14px; }
        .summary-card .amount { font-size: 24px; font-weight: bold; color: #1e293b; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: #f3f4f6; font-weight: 600; }
        .total-row { font-weight: bold; border-top: 2px solid #1e293b; }
        .footer { margin-top: 40px; text-align: center; color: #6b7280; font-size: 12px; }
        @media print { 
            body { margin: 20px; }
            .summary-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <h1>Contract Analysis Report</h1>
    
    <div class="header-info">
        <h2>Contract Details</h2>
        <p><strong>Position:</strong> ${analysis.jobTitle}</p>
        <p><strong>Contract Length:</strong> ${analysis.contractWeeks} weeks</p>
        <p><strong>Hours per Week:</strong> ${analysis.hoursPerWeek}</p>  
        <p><strong>Hourly Rate:</strong> $${analysis.hourlyRate}</p>
        <p><strong>Generated:</strong> ${analysis.timestamp}</p>
    </div>
    
    <div class="summary-grid">
        <div class="summary-card">
            <h3>Total Contract Value</h3>
            <div class="amount">${analysis.totalValue}</div>
        </div>
        <div class="summary-card">
            <h3>True Hourly Rate</h3>
            <div class="amount">${analysis.trueHourlyRate}</div>
        </div>
        <div class="summary-card">
            <h3>Weekly Gross Pay</h3>
            <div class="amount">${analysis.weeklyGrossPay}</div>
        </div>
        <div class="summary-card">
            <h3>Annual Equivalent</h3>
            <div class="amount">${analysis.annualEquivalent}</div>
        </div>
    </div>
    
    <h2>Pay Breakdown</h2>
    <table>
        <thead>
            <tr>
                <th>Component</th>
                <th>Rate/Amount</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Regular Pay</td>
                <td>$${analysis.hourlyRate}/hr</td>
                <td>${analysis.hoursPerWeek} hrs/week × ${analysis.contractWeeks} weeks</td>
            </tr>
            <tr>
                <td>Housing Stipend</td>
                <td>$${analysis.housingStipend}/week</td>
                <td>Total: ${analysis.totalHousingStipend}</td>
            </tr>
            <tr>
                <td>Travel Reimbursement</td>
                <td>$${analysis.travelReimbursement}</td>
                <td>One-time reimbursement</td>
            </tr>
            <tr>
                <td>Other Stipends</td>
                <td>$${analysis.otherStipends}</td>
                <td>Additional benefits</td>
            </tr>
        </tbody>
    </table>
    
    <div class="footer">
        <p>Generated by LocumTrueRate Contract Calculator</p>
        <p><em>This analysis is for informational purposes only. Consult with financial advisors for tax planning.</em></p>
    </div>
</body>
</html>`;
                
                // Create downloadable HTML file instead of relying on popups
                const blob = new Blob([pdfContent], { type: 'text/html;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.setAttribute('href', url);
                
                // Create safe filename
                const jobTitle = analysis.jobTitle.replace(/[^a-z0-9]/gi, '_').toLowerCase() || 'contract';
                const dateStr = new Date().toISOString().split('T')[0];
                const filename = `contract_analysis_${jobTitle}_${dateStr}.html`;
                
                link.setAttribute('download', filename);
                link.style.display = 'none';
                
                console.log('📄 Triggering PDF HTML download:', filename);
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up the URL after download
                setTimeout(() => {
                    URL.revokeObjectURL(url);
                    console.log('📄 PDF URL cleaned up');
                }, 1000);
                
                showNotification('📄 PDF report downloaded as HTML file: ' + filename + '. Use browser Print -> Save as PDF', 'success');
                
            } catch (error) {
                console.error('❌ PDF export error:', error);
                showNotification('⚠️ PDF export failed: ' + error.message, 'error');
            }
        }

        
        // Show notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                font-weight: 500;
                z-index: 10001;
                opacity: 0;
                transition: opacity 0.3s ease;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            
            if (type === 'success') {
                notification.style.background = '#10b981';
            } else if (type === 'error') {
                notification.style.background = '#ef4444';
            } else {
                notification.style.background = '#2563eb';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Fade in
            setTimeout(() => notification.style.opacity = '1', 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
        
        // Update comparison cards with saved contract data
        function updateComparisonCards() {
            const savedContracts = JSON.parse(localStorage.getItem('savedContracts') || '[]');
            if (savedContracts.length > 0) {
                const lastContract = savedContracts[0];
                const previousCard = document.querySelector('.comparison-grid .comparison-card:nth-child(3)');
                if (previousCard) {
                    const valueElement = previousCard.querySelector('.comparison-value');
                    if (valueElement && lastContract.trueHourlyRate) {
                        valueElement.textContent = lastContract.trueHourlyRate;
                    }
                }
            }
        }
        
        // Simplified calculation trigger for hourly rate changes
        document.getElementById('hourlyRate').addEventListener('input', function() {
            calculateContract();
        });

        // Check for pre-filled data from job board
        function checkPrefilledData() {
            console.log('🔍 checkPrefilledData() called');
            const calculatorData = localStorage.getItem('calculatorData');
            if (calculatorData) {
                const data = JSON.parse(calculatorData);
                
                // Fill form with job data
                if (data.hourlyRate) document.getElementById('hourlyRate').value = data.hourlyRate;
                if (data.hoursPerWeek) document.getElementById('hoursPerWeek').value = data.hoursPerWeek;
                if (data.contractWeeks) document.getElementById('contractWeeks').value = data.contractWeeks;
                if (data.housingStipend) document.getElementById('housingStipend').value = data.housingStipend;
                if (data.jobTitle) document.getElementById('jobTitle').value = data.jobTitle;
                
                // Show alert
                document.getElementById('prefilledAlert').classList.add('show');
                
                // Clear the data
                localStorage.removeItem('calculatorData');
                
                // Calculate with new data
                console.log('🔄 Calling calculateContract() from checkPrefilledData');
                calculateContract();
            } else {
                console.log('📝 No prefilled data found in localStorage');
            }
        }

        // Initialize calculator
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📄 DOMContentLoaded event fired');
            
            // Comprehensive element checking
            console.log('🔍 COMPREHENSIVE ELEMENT CHECK STARTING...');
            
            // Check all input elements
            const inputElements = {
                'jobTitle': 'Job Title dropdown',
                'hourlyRate': 'Hourly Rate input',
                'hoursPerWeek': 'Hours per Week input',
                'contractWeeks': 'Contract Weeks input',
                'housingStipend': 'Housing Stipend input',
                'travelReimbursement': 'Travel Reimbursement input',
                'otherStipends': 'Other Stipends input',
                'contractType': 'Contract Type dropdown',
                'workState': 'Work State dropdown'
            };
            
            console.log('🔍 Checking input elements...');
            const missingInputs = [];
            Object.entries(inputElements).forEach(([id, name]) => {
                const elem = document.getElementById(id);
                if (!elem) {
                    missingInputs.push(`${name} (#${id})`);
                    console.error(`❌ MISSING INPUT: ${name} (#${id})`);
                } else {
                    console.log(`✅ Found: ${name} (#${id})`);
                }
            });
            
            // Check all result display elements
            console.log('🔍 Checking result display elements...');
            const resultElements = {
                'weeklyGrossPay': 'Weekly Gross Pay',
                'totalContractValue': 'Total Contract Value',
                'trueHourlyRate': 'True Hourly Rate',
                'yourContractRate': 'Your Contract Rate',
                'annualEquivalent': 'Annual Equivalent',
                'totalHousingStipend': 'Total Housing Stipend',
                'otherStipends': 'Other Stipends Result',
                'grossTaxableIncome': 'Gross Taxable Income',
                'netTakeHome': 'Net Take Home',
                'regularPay': 'Regular Pay',
            };
            
            const missingResults = [];
            Object.entries(resultElements).forEach(([id, name]) => {
                const elem = document.getElementById(id);
                if (!elem) {
                    missingResults.push(`${name} (#${id})`);
                    console.error(`❌ MISSING RESULT ELEMENT: ${name} (#${id})`);
                } else {
                    console.log(`✅ Found: ${name} (#${id})`);
                }
            });
            
            // Check action buttons
            console.log('🔍 Checking action buttons...');
            const actionButtons = {
                'saveButton': 'Save Button',
                'compareButton': 'Compare Button',
                'printButton': 'Print Button',
                'exportPdfButton': 'Export PDF Button',
                'exportCsvButton': 'Export CSV Button',
                'shareButton': 'Share Button'
            };
            
            const missingButtons = [];
            Object.entries(actionButtons).forEach(([id, name]) => {
                const elem = document.getElementById(id);
                if (!elem) {
                    missingButtons.push(`${name} (#${id})`);
                    console.error(`❌ MISSING BUTTON: ${name} (#${id})`);
                } else {
                    console.log(`✅ Found: ${name} (#${id})`);
                }
            });
            
            // Summary
            console.log('📊 ELEMENT CHECK SUMMARY:');
            console.log(`🔵 Missing ${missingInputs.length} input elements`);
            console.log(`🔴 Missing ${missingResults.length} result elements`);
            console.log(`🟠 Missing ${missingButtons.length} action buttons`);
            
            if (missingInputs.length > 0 || missingResults.length > 0) {
                console.error('❌❌❌ CRITICAL FAILURES DETECTED! Calculator cannot function properly!');
                console.error('Missing elements will cause JavaScript errors and prevent calculations');
            }
            
            try {
                console.log('🔍 Calling checkPrefilledData()...');
                checkPrefilledData();
                console.log('✅ checkPrefilledData() completed');
                
                console.log('🔍 Calling updateButtonStates()...');
                updateButtonStates();
                console.log('✅ updateButtonStates() completed');
                
                console.log('🔍 Calling calculateContract()...');
                calculateContract();
                console.log('✅ calculateContract() completed');
            } catch (error) {
                console.error('❌ Error during initialization:', error);
                console.error('Stack trace:', error.stack);
            }
            
            // Fix input field usability issues
            const numberInputs = document.querySelectorAll('input[type="number"]');
            numberInputs.forEach(input => {
                // Fix Ctrl+A to only select input text, not entire page
                input.addEventListener('keydown', function(e) {
                    if (e.ctrlKey && e.key === 'a') {
                        e.preventDefault();
                        e.stopPropagation();
                        this.select();
                    }
                });
                
                // Better double-click behavior
                input.addEventListener('dblclick', function(e) {
                    e.preventDefault();
                    this.select();
                });
                
                // Focus behavior - more reliable selection
                input.addEventListener('focus', function(e) {
                    // Prevent immediate selection to fix typing glitch
                    if (e.detail === 0) {  // Keyboard focus
                        this.select();
                    } else {  // Mouse focus
                        setTimeout(() => this.select(), 50);
                    }
                });
                
                // Fix first keystroke issue
                input.addEventListener('click', function() {
                    this.focus();
                });
                
                // Clear error state on input
                input.addEventListener('input', function() {
                    if (this.classList.contains('error')) {
                        this.classList.remove('error');
                        const errorElement = document.getElementById(this.id + '-error');
                        if (errorElement) {
                            errorElement.classList.remove('show');
                        }
                    }
                });
            });
            
            // Fix button click reliability (prevent rapid double-clicks only)
            const buttons = document.querySelectorAll('a[href], button');
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    // Prevent rapid double-clicking issues
                    if (this.dataset.clicking) {
                        e.preventDefault();
                        return false;
                    }
                    this.dataset.clicking = 'true';
                    setTimeout(() => {
                        delete this.dataset.clicking;
                    }, 500);
                });
            });
        });
    </script>

    <!-- Floating Logger Component -->
    <button id="logger-toggle-fab" class="logger-toggle-fab" onclick="toggleLoggerVisibility()" title="Toggle Console Logger">
        <span id="fab-icon">🔍</span>
    </button>
    
    <div id="floating-logger" class="floating-logger">
        <div class="logger-header">
            <span class="logger-title">Console Logger</span>
            <div class="logger-controls">
                <button class="logger-btn" onclick="clearLogs()" title="Clear logs">🗑️</button>
                <button class="logger-btn" onclick="copyLogs()" title="Copy logs">📋</button>
                <button class="logger-btn" onclick="minimizeLogger()" title="Minimize logger">
                    <span id="minimize-icon">−</span>
                </button>
                <button class="logger-btn" onclick="toggleLogger()" title="Toggle logger">
                    <span id="toggle-icon">▼</span>
                </button>
            </div>
        </div>
        <div id="logger-content" class="logger-content">
            <div id="logger-messages" class="logger-messages"></div>
        </div>
    </div>

    <style>
        /* Floating Logger Styles */
        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --surface-color: #ffffff;
            --border-color: #e2e8f0;
            --background-color: #f8fafc;
            --text-primary: #1e293b;
            --text-muted: #94a3b8;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
        }

        /* Floating Action Button for toggling logger */
        .logger-toggle-fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .logger-toggle-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .logger-toggle-fab.visible {
            display: flex;
        }

        .floating-logger {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 400px;
            max-width: 85vw;
            background-color: var(--surface-color);
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 9999;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .floating-logger.hidden {
            display: none;
        }

        .logger-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.6rem 0.6rem 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .logger-title {
            font-weight: 600;
            font-size: 14px;
        }

        .logger-controls {
            display: flex;
            gap: 0.5rem;
        }

        .logger-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
        }

        .logger-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .logger-content {
            max-height: 250px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .logger-content.collapsed {
            max-height: 0;
        }

        .logger-messages {
            padding: 1rem;
            overflow-y: auto;
            max-height: 250px;
            background-color: var(--background-color);
        }

        .log-entry {
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--border-color);
            background-color: var(--surface-color);
            border-radius: 0.5rem;
            word-wrap: break-word;
            line-height: 1.6; /* Better OCR readability */
            letter-spacing: 0.02em; /* Slight letter spacing for OCR */
        }

        .log-entry.log {
            border-left-color: var(--primary-color);
        }

        .log-entry.warn {
            border-left-color: var(--warning-color);
            background-color: rgba(245, 158, 11, 0.08);
        }

        .log-entry.error {
            border-left-color: var(--error-color);
            background-color: rgba(239, 68, 68, 0.08);
        }

        .log-timestamp {
            color: var(--text-muted);
            font-size: 12px; /* Larger for OCR */
            margin-right: 0.75rem;
            font-weight: 500;
        }

        .log-message {
            color: var(--text-primary);
            font-size: 14px; /* Ensure consistent size */
            font-weight: 400;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .floating-logger {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }
        }
    </style>

    <script>
        // Floating Logger Implementation
        (function() {
            // Store original console methods
            const originalLog = console.log;
            const originalWarn = console.warn;
            const originalError = console.error;
            
            // Logger state
            let isCollapsed = false;
            let isHidden = false;
            const maxLogs = 100;
            const logs = [];
            
            // Initialize logger
            function initLogger() {
                // Override console methods
                console.log = function(...args) {
                    logMessage('log', args);
                    originalLog.apply(console, args);
                };
                
                console.warn = function(...args) {
                    logMessage('warn', args);
                    originalWarn.apply(console, args);
                };
                
                console.error = function(...args) {
                    logMessage('error', args);
                    originalError.apply(console, args);
                };
                
                // Add initial message
                console.log('🚀 Floating Logger initialized');
                
                // Default to minimized to avoid UI obstruction
                isHidden = true;
            }
            
            // Log message to floating logger
            function logMessage(type, args) {
                const timestamp = new Date().toLocaleTimeString();
                const message = args.map(arg => {
                    if (typeof arg === 'object') {
                        try {
                            return JSON.stringify(arg, null, 2);
                        } catch (e) {
                            return String(arg);
                        }
                    }
                    return String(arg);
                }).join(' ');
                
                // Add to logs array
                logs.push({ type, timestamp, message });
                if (logs.length > maxLogs) {
                    logs.shift();
                }
                
                // Update UI
                updateLoggerUI();
            }
            
            // Update logger UI
            function updateLoggerUI() {
                const messagesContainer = document.getElementById('logger-messages');
                if (!messagesContainer) return;
                
                messagesContainer.innerHTML = logs.map(log => `
                    <div class="log-entry ${log.type}">
                        <span class="log-timestamp">${log.timestamp}</span>
                        <span class="log-message">${escapeHtml(log.message)}</span>
                    </div>
                `).join('');
                
                // Auto-scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
            
            // Escape HTML for safe display
            function escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
            
            // Toggle logger visibility (show/hide entire logger)
            window.toggleLoggerVisibility = function() {
                isHidden = !isHidden;
                const logger = document.getElementById('floating-logger');
                const fab = document.getElementById('logger-toggle-fab');
                
                if (isHidden) {
                    logger.classList.add('hidden');
                    fab.classList.add('visible');
                } else {
                    logger.classList.remove('hidden');
                    fab.classList.remove('visible');
                }
            };
            
            // Minimize logger (hide from view, show FAB)
            window.minimizeLogger = function() {
                const logger = document.getElementById('floating-logger');
                const fab = document.getElementById('logger-toggle-fab');
                logger.classList.add('hidden');
                fab.classList.add('visible');
                isHidden = true;
            };
            
            // Toggle logger collapse/expand
            window.toggleLogger = function() {
                isCollapsed = !isCollapsed;
                const content = document.getElementById('logger-content');
                const icon = document.getElementById('toggle-icon');
                
                if (isCollapsed) {
                    content.classList.add('collapsed');
                    icon.textContent = '▲';
                } else {
                    content.classList.remove('collapsed');
                    icon.textContent = '▼';
                }
            };
            
            // Clear logs
            window.clearLogs = function() {
                logs.length = 0;
                updateLoggerUI();
                console.log('🗑️ Logs cleared');
            };
            
            // Copy logs to clipboard
            window.copyLogs = function() {
                const logText = logs.map(log => 
                    `[${log.timestamp}] ${log.type.toUpperCase()}: ${log.message}`
                ).join('\n');
                
                navigator.clipboard.writeText(logText).then(() => {
                    console.log('📋 Logs copied to clipboard');
                }).catch(err => {
                    console.error('Failed to copy logs:', err);
                });
            };
            
            // Make logger draggable
            function makeLoggerDraggable() {
                const logger = document.getElementById('floating-logger');
                const header = logger.querySelector('.logger-header');
                let isDragging = false;
                let currentX;
                let currentY;
                let initialX;
                let initialY;
                let xOffset = 0;
                let yOffset = 0;
                
                header.addEventListener('mousedown', dragStart);
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', dragEnd);
                
                function dragStart(e) {
                    if (e.target.closest('.logger-controls')) return;
                    
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                    
                    if (e.target === header || e.target.closest('.logger-title')) {
                        isDragging = true;
                    }
                }
                
                function drag(e) {
                    if (!isDragging) return;
                    
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    
                    xOffset = currentX;
                    yOffset = currentY;
                    
                    logger.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
                
                function dragEnd() {
                    initialX = currentX;
                    initialY = currentY;
                    isDragging = false;
                }
            }
            
            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    initLogger();
                    makeLoggerDraggable();
                    // Start visible for debugging
                    // document.getElementById('floating-logger').classList.add('hidden');
                    // document.getElementById('logger-toggle-fab').classList.add('visible');
                    console.log('🚀 Debug logger started in visible mode');
                });
            } else {
                initLogger();
                makeLoggerDraggable();
                // Start visible for debugging
                // setTimeout(() => {
                //     document.getElementById('floating-logger').classList.add('hidden');
                //     document.getElementById('logger-toggle-fab').classList.add('visible');
                // }, 100);
                console.log('🚀 Debug logger started in visible mode');
            }
        })();
    </script>
</body>
</html>
